import{a as w,u as L,j as e,L as y}from"./app-CNGjdSTo.js";import{A as S}from"./app-layout-Yr-265i6.js";import{S as _}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-BxtkxcwU.js";import"./index-BPuxuOo8.js";import"./index-DMsz7JPz.js";import"./x-B8MTmYU5.js";import"./createLucideIcon-BNUT-dRz.js";const C=({item:r,index:o,onItemChange:c,onRemove:k,errors:N,lists:i})=>{const d=i?.kategoriList||[];i?.merekList,i?.modelList,i?.serialNumberList;const n=i.kategoriList.find(a=>a.nama===r.kategori)?.id,x=n?i.merekList.filter(a=>a.model_barang?.some(s=>s.kategori_id===n)):i.merekList,j=i.merekList.find(a=>a.nama===r.merek)?.id,m=i.modelList.filter(a=>a.merek_id===j&&a.kategori_id===n);let g=[];if(r.model&&r.merek){const a=`${r.merek}|${r.model}`;g=i.serialNumberList[a]||[]}else if(r.merek)g=Object.entries(i.serialNumberList).filter(([a])=>a.startsWith(`${r.merek}|`)).flatMap(([,a])=>a);else if(r.kategori&&n){const a=x.map(s=>s.nama);g=Object.entries(i.serialNumberList).filter(([s])=>a.includes(s.split("|")[0])).flatMap(([,s])=>s)}const f=r.keluar_info.map(a=>a.serial_number),v=g.filter(a=>!f.includes(a)),p=(a,s)=>{const t={...r,[a]:s};a==="kategori"?(t.merek="",t.model="",t.keluar_info=[{serial_number:"",status_keluar:"dipinjamkan"}]):a==="merek"&&(t.model="",t.keluar_info=[{serial_number:"",status_keluar:"dipinjamkan"}]),c(o,t)},l=(a,s,t)=>{const h=[...r.keluar_info];h[a]={...h[a],[s]:t},c(o,{...r,keluar_info:h})},u=()=>{const a=[...r.keluar_info,{serial_number:"",status_keluar:"dipinjamkan"}];c(o,{...r,keluar_info:a})},b=a=>{const s=r.keluar_info.filter((t,h)=>h!==a);c(o,{...r,keluar_info:s})};return e.jsxs("div",{className:"relative mb-6 rounded-lg border-2 border-gray-200 p-4",children:[e.jsxs("h3",{className:"mb-3 text-lg font-semibold text-gray-700",children:["Item #",o+1]}),k&&e.jsx("button",{type:"button",onClick:k,className:"absolute top-2 right-2 font-bold text-red-500 hover:text-red-700",children:"Ã— Hapus Item"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Kategori"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:r.kategori,onChange:a=>p("kategori",a.target.value),children:[e.jsx("option",{value:"",children:"-- Pilih Kategori --"}),d.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Merek"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:r.merek,onChange:a=>p("merek",a.target.value),disabled:!r.kategori,children:[e.jsx("option",{value:"",children:"-- Pilih Merek --"}),x.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Model"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:r.model,onChange:a=>p("model",a.target.value),disabled:!r.merek,children:[e.jsx("option",{value:"",children:"-- Pilih Model --"}),m.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-red-700",children:"Serial Number & Status"}),r.keluar_info.map((a,s)=>e.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded border-2 border-red-400 bg-red-50 p-2",value:a.serial_number,onChange:t=>l(s,"serial_number",t.target.value),placeholder:`Serial #${s+1}`,list:`serial-suggest-${o}-${s}`}),e.jsx("datalist",{id:`serial-suggest-${o}-${s}`,children:v.map(t=>e.jsx("option",{value:t},t))}),r.keluar_info.length>1&&e.jsx("button",{type:"button",className:"text-sm text-red-600 hover:underline",onClick:()=>b(s),children:"Hapus"})]}),e.jsx("div",{children:e.jsxs("select",{value:a.status_keluar,onChange:t=>l(s,"status_keluar",t.target.value),className:"w-full rounded border-2 border-blue-400 bg-blue-50 p-2",children:[e.jsx("option",{value:"dipinjamkan",children:"Dipinjamkan"}),e.jsx("option",{value:"dijual",children:"Dijual"}),e.jsx("option",{value:"maintenance",children:"Maintenance"})]})})]},s)),e.jsx("button",{type:"button",className:"mt-1 text-sm text-blue-600 hover:underline",onClick:u,children:"+ Tambah Serial"})]})]})};function A(){const{barangKeluar:r,lokasiList:o,kategoriList:c,merekList:k,modelList:N,serialNumberList:i}=w().props,{data:d,setData:n,put:x,processing:j,errors:m}=L({tanggal:r.tanggal,lokasi:r.lokasi,items:r.items}),g=(l,u)=>{const b=[...d.items];b[l]=u,n("items",b)},f=()=>{n("items",[...d.items,{kategori:"",merek:"",model:"",keluar_info:[{serial_number:"",status_keluar:"dipinjamkan"}]}])},v=l=>{n("items",d.items.filter((u,b)=>b!==l))},p=l=>{l.preventDefault(),x(route("barang-keluar.update",r.id),{onSuccess:()=>{_.fire({icon:"success",title:"Berhasil",text:"Data barang keluar berhasil diperbarui!",timer:2e3,showConfirmButton:!1})},onError:()=>{_.fire({icon:"error",title:"Gagal",text:"Periksa kembali isian form Anda."})}})};return e.jsx(S,{children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Edit Transaksi Barang Keluar"}),e.jsxs("form",{onSubmit:p,className:"rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b pb-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Tanggal"}),e.jsx("input",{type:"date",className:"mt-1 w-full rounded border p-2",value:d.tanggal,onChange:l=>n("tanggal",l.target.value)}),m.tanggal&&e.jsx("p",{className:"text-sm text-red-500",children:m.tanggal})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Tujuan Distribusi"}),e.jsx("input",{type:"text",list:"lokasi-suggest",className:"mt-1 w-full rounded border p-2",value:d.lokasi,onChange:l=>n("lokasi",l.target.value)}),e.jsx("datalist",{id:"lokasi-suggest",children:o.map(l=>e.jsx("option",{value:l.nama},l.id))}),m.lokasi&&e.jsx("p",{className:"text-sm text-red-500",children:m.lokasi})]})]}),d.items.map((l,u)=>e.jsx(C,{item:l,index:u,onItemChange:g,onRemove:d.items.length>1?()=>v(u):void 0,errors:m,lists:{kategoriList:c,merekList:k,modelList:N,serialNumberList:i}},u)),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:f,className:"rounded bg-green-500 px-4 py-2 text-white hover:bg-green-600",children:"+ Tambah Item"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(y,{href:route("barang-keluar.index"),className:"rounded bg-gray-500 px-6 py-2 text-white hover:bg-gray-600",children:"Kembali"}),e.jsx("button",{type:"submit",disabled:j,className:"rounded bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:"Perbarui Transaksi"})]})]})]})]})})}export{A as default};
