import{a as M,r as j,u as B,j as e,L as K}from"./app-CNGjdSTo.js";import{s as I,B as P}from"./TransactionPreview-1HySTxO4.js";import{A as $}from"./app-layout-Yr-265i6.js";import{S as C}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-BxtkxcwU.js";import"./index-BPuxuOo8.js";import"./index-DMsz7JPz.js";import"./x-B8MTmYU5.js";import"./createLucideIcon-BNUT-dRz.js";const D=({item:r,index:c,onItemChange:b,onRemove:y,errors:g,lists:o,usedModels:v})=>{const[S,N]=j.useState(!1),[n,m]=j.useState(!1),k=o.kategoriList.find(a=>a.nama===r.kategori)?.id,h=k?o.merekList.filter(a=>a.model_barang?.some(t=>t.kategori_id===k)):o.merekList,d=o.merekList.find(a=>a.nama===r.merek)?.id,_=o.modelList.filter(a=>a.merek_id===d&&a.kategori_id===k);let x=[];if(r.model&&r.merek){const a=`${r.merek}|${r.model}`;x=o.serialNumberList[a]||[]}else if(r.merek)x=Object.entries(o.serialNumberList).filter(([a])=>a.startsWith(`${r.merek}|`)).flatMap(([,a])=>a);else if(r.kategori&&k){const a=h.map(t=>t.nama);x=Object.entries(o.serialNumberList).filter(([t])=>a.includes(t.split("|")[0])).flatMap(([,t])=>t)}const L=r.keluar_info.map(a=>a.serial_number),z=x.filter(a=>!L.includes(a)),p=(a,t)=>{const i={...r,[a]:t};a==="kategori"?(i.merek="",i.model="",i.keluar_info=[{serial_number:"",status_keluar:"dipinjamkan"}]):a==="merek"&&(i.model="",i.keluar_info=[{serial_number:"",status_keluar:"dipinjamkan"}]),b(c,i)},s=(a,t,i)=>{const f=[...r.keluar_info];f[a]={...f[a],[t]:i},b(c,{...r,keluar_info:f})},l=()=>{const a=[...r.keluar_info,{serial_number:"",status_keluar:"dipinjamkan"}];b(c,{...r,keluar_info:a})},u=a=>{const t=r.keluar_info.filter((i,f)=>f!==a);b(c,{...r,keluar_info:t})},w=a=>{const t=[...r.keluar_info.filter(i=>i.serial_number.trim()),...a.map(i=>({serial_number:i,status_keluar:"dipinjamkan"}))];b(c,{...r,keluar_info:t.length>0?t:[{serial_number:"",status_keluar:"dipinjamkan"}]})};return e.jsxs("div",{className:"relative mb-6 rounded-xl border border-gray-200 bg-white p-5 shadow-sm dark:border-zinc-700 dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b border-gray-100 pb-3 dark:border-zinc-800",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:["Item #",c+1]}),y&&e.jsx("button",{type:"button",onClick:y,className:"rounded-md bg-red-50 px-3 py-1 text-sm font-medium text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30",children:"Ã— Hapus"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Kategori"}),e.jsxs("select",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:r.kategori,onChange:a=>p("kategori",a.target.value),children:[e.jsx("option",{value:"",children:"-- Pilih Kategori --"}),o.kategoriList.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),g.kategori&&e.jsx("p",{className:"text-xs text-red-500",children:g.kategori})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Merek"}),e.jsxs("select",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white dark:disabled:bg-zinc-700",value:r.merek,onChange:a=>p("merek",a.target.value),disabled:!r.kategori,children:[e.jsx("option",{value:"",children:"-- Pilih Merek --"}),h.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),g.merek&&e.jsx("p",{className:"text-xs text-red-500",children:g.merek})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Model"}),e.jsxs("select",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white dark:disabled:bg-zinc-700",value:r.model,onChange:a=>p("model",a.target.value),disabled:!r.merek,children:[e.jsx("option",{value:"",children:"-- Pilih Model --"}),_.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]}),g.model&&e.jsx("p",{className:"text-xs text-red-500",children:g.model})]})]}),e.jsxs("div",{className:"mt-5 rounded-lg border border-gray-200 bg-gray-50/50 p-4 dark:border-zinc-700 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-800 dark:text-white",children:["Serial Number & Status",e.jsxs("span",{className:"ml-2 rounded-full bg-orange-100 px-2 py-0.5 text-xs text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",children:[r.keluar_info.filter(a=>a.serial_number.trim()).length," unit"]})]}),e.jsx(P,{existingSerials:r.keluar_info.map(a=>a.serial_number),onSerialsParsed:w})]}),r.keluar_info.map((a,t)=>e.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:a.serial_number,onChange:i=>s(t,"serial_number",i.target.value),placeholder:`Serial #${t+1}`,list:`serial-suggest-${c}-${t}`}),e.jsx("datalist",{id:`serial-suggest-${c}-${t}`,children:z.map(i=>e.jsx("option",{value:i},i))}),r.keluar_info.length>1&&e.jsx("button",{type:"button",className:"rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400",onClick:()=>u(t),children:"Hapus"})]}),e.jsx("div",{children:e.jsxs("select",{value:a.status_keluar,onChange:i=>s(t,"status_keluar",i.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",children:[e.jsx("option",{value:"dipinjamkan",children:"Dipinjamkan"}),e.jsx("option",{value:"dijual",children:"Dijual"}),e.jsx("option",{value:"maintenance",children:"Maintenance"})]})})]},t)),e.jsxs("button",{type:"button",className:"mt-2 inline-flex items-center gap-1 rounded-md border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-gray-300 dark:hover:bg-zinc-700",onClick:l,children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Tambah Serial"]})]})]})};function V(){const{lokasiList:r,kategoriList:c,merekList:b,modelList:y,serialNumberList:g}=M().props,[o,v]=j.useState([]),[S,N]=j.useState(!1),{data:n,setData:m,post:k,processing:h,errors:d,reset:_}=B({tanggal:new Date().toISOString().slice(0,10),lokasi:"",sub_lokasi:"",pic:"",items:[{kategori:"",merek:"",model:"",keluar_info:[{serial_number:"",status_keluar:"dipinjamkan"}]}]});j.useEffect(()=>{if(n.lokasi){const s=r.find(l=>l.nama===n.lokasi)?.id;s?(N(!0),fetch(`/api/sub-lokasi-by-lokasi?lokasi_id=${s}`).then(l=>l.json()).then(l=>{v(l)}).finally(()=>N(!1))):v([])}else v([])},[n.lokasi,r]);const x=(s,l)=>{const u=[...n.items];u[s]=l,m("items",u)},L=()=>{m("items",[...n.items,{kategori:"",merek:"",model:"",keluar_info:[{serial_number:"",status_keluar:"dipinjamkan"}]}])},z=s=>{m("items",n.items.filter((l,u)=>u!==s))},p=async s=>{s.preventDefault(),await I(n,"keluar")&&k(route("barang-keluar.store"),{onSuccess:()=>{C.fire({icon:"success",title:"Berhasil",text:"Data barang keluar berhasil disimpan!",timer:2e3,showConfirmButton:!1}),_()},onError:()=>{C.fire({icon:"error",title:"Gagal",text:"Periksa kembali isian form Anda."})}})};return e.jsx($,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 dark:bg-zinc-950",children:e.jsxs("div",{className:"mx-auto max-w-5xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Buat Transaksi Barang Keluar"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Distribusikan barang ke lokasi tujuan"})]}),e.jsxs("form",{onSubmit:p,className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-zinc-700 dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b border-gray-100 pb-6 md:grid-cols-2 lg:grid-cols-4 dark:border-zinc-800",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tanggal"}),e.jsx("input",{type:"date",className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:n.tanggal,onChange:s=>m("tanggal",s.target.value)}),d.tanggal&&e.jsx("p",{className:"text-xs text-red-500",children:d.tanggal})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tujuan Distribusi"}),e.jsxs("select",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:n.lokasi,onChange:s=>{m("lokasi",s.target.value),m("sub_lokasi","")},children:[e.jsx("option",{value:"",children:"-- Pilih Lokasi Tujuan --"}),r.map(s=>e.jsx("option",{value:s.nama,children:s.nama},s.id))]}),d.lokasi&&e.jsx("p",{className:"text-xs text-red-500",children:d.lokasi})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Sub-Lokasi",S&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(memuat...)"})]}),e.jsxs("select",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white dark:disabled:bg-zinc-700",value:n.sub_lokasi,onChange:s=>m("sub_lokasi",s.target.value),disabled:!n.lokasi||o.length===0,children:[e.jsx("option",{value:"",children:"-- Pilih Sub-Lokasi --"}),o.map(s=>e.jsxs("option",{value:s.nama,children:[s.nama," ",s.lantai?`(Lt. ${s.lantai})`:""]},s.id))]}),d.sub_lokasi&&e.jsx("p",{className:"text-xs text-red-500",children:d.sub_lokasi})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"PIC (Penanggung Jawab)"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm transition focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-white",value:n.pic,onChange:s=>m("pic",s.target.value),placeholder:"Nama penanggung jawab..."}),d.pic&&e.jsx("p",{className:"text-xs text-red-500",children:d.pic})]})]}),n.items.map((s,l)=>{const u={},w=`items.${l}.`;for(const t in d)if(t.startsWith(w)){const i=t.substring(w.length);u[i]=d[t]}const a=n.items.filter((t,i)=>i!==l).map(t=>t.model).filter(Boolean);return e.jsx(D,{item:s,index:l,onItemChange:x,onRemove:n.items.length>1?()=>z(l):void 0,errors:u,lists:{kategoriList:c,merekList:b,modelList:y,serialNumberList:g},usedModels:a},l)}),e.jsxs("div",{className:"mt-8 flex flex-col items-center justify-between gap-4 border-t border-gray-100 pt-6 sm:flex-row dark:border-zinc-800",children:[e.jsxs("button",{type:"button",onClick:L,className:"inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2.5 text-sm font-medium text-white shadow-sm transition hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-700",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Tambah Item"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(K,{href:route("barang-keluar.index"),className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-5 py-2.5 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-gray-300 dark:hover:bg-zinc-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Kembali"]}),e.jsx("button",{type:"submit",disabled:h,className:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-6 py-2.5 text-sm font-medium text-white shadow-sm transition hover:bg-blue-700 disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600",children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Simpan Transaksi"]})})]})]})]})]})})})}export{V as default};
