import{a as w,u as C,r as c,j as e,L as K}from"./app-CNGjdSTo.js";import{A as P}from"./app-layout-Yr-265i6.js";import{S as N}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-BxtkxcwU.js";import"./index-BPuxuOo8.js";import"./index-DMsz7JPz.js";import"./x-B8MTmYU5.js";import"./createLucideIcon-BNUT-dRz.js";const $=({item:s,index:o,onItemChange:r,onRemove:n,lokasiId:d})=>{const[p,b]=c.useState([]),[k,x]=c.useState([]),[j,f]=c.useState([]),[v,l]=c.useState([]),[m,h]=c.useState([]);c.useEffect(()=>{d&&(fetch(`/api/kategori-by-lokasi/${d}`).then(a=>a.json()).then(b),s.kategori&&fetch(`/api/merek-by-kategori/${d}/${encodeURIComponent(s.kategori)}`).then(a=>a.json()).then(x),s.merek&&fetch(`/api/model-by-merek/${d}/${encodeURIComponent(s.merek)}`).then(a=>a.json()).then(f),s.model&&fetch(`/api/serial-by-model/${d}/${encodeURIComponent(s.model)}`).then(a=>a.json()).then(a=>{const t=s.kembali_info.map(g=>g.serial_number),i=[...new Set([...a,...t])];l(i)}))},[d,s.kategori,s.merek,s.model]);const u=(a,t)=>{const i={...s,[a]:t};a==="kategori"?(i.merek="",i.model="",i.kembali_info=[{serial_number:"",kondisi:"bagus"}]):a==="merek"?(i.model="",i.kembali_info=[{serial_number:"",kondisi:"bagus"}]):a==="model"&&(i.kembali_info=[{serial_number:"",kondisi:"bagus"}]),r(o,i)},_=(a,t,i)=>{const g=[...s.kembali_info];g[a]={...g[a],[t]:i},r(o,{...s,kembali_info:g})},y=()=>r(o,{...s,kembali_info:[...s.kembali_info,{serial_number:"",kondisi:"bagus"}]}),S=a=>r(o,{...s,kembali_info:s.kembali_info.filter((t,i)=>i!==a)});return e.jsxs("div",{className:"relative mb-6 rounded-lg border-2 border-gray-200 p-4",children:[e.jsxs("h3",{className:"mb-3 text-lg font-semibold text-gray-700",children:["Item Pengembalian #",o+1]}),n&&e.jsx("button",{type:"button",onClick:n,className:"absolute top-2 right-2 font-bold text-red-500 hover:text-red-700",children:"Ã— Hapus Item"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Kategori"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.kategori,onChange:a=>u("kategori",a.target.value),disabled:!d,children:[e.jsx("option",{value:"",children:"-- Pilih Kategori --"}),p.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Merek"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.merek,onChange:a=>u("merek",a.target.value),disabled:!s.kategori,children:[e.jsx("option",{value:"",children:"-- Pilih Merek --"}),k.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Model"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.model,onChange:a=>u("model",a.target.value),disabled:!s.merek,children:[e.jsx("option",{value:"",children:"-- Pilih Model --"}),j.map(a=>e.jsx("option",{value:a.nama,children:a.nama},a.id))]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-red-700",children:"Serial Number & Kondisi"}),s.kembali_info.map((a,t)=>e.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 rounded border-2 border-red-400 bg-red-50 p-2",value:a.serial_number,onChange:i=>_(t,"serial_number",i.target.value),placeholder:`Serial #${t+1}`,list:`serial-suggest-${o}`,disabled:!s.model}),s.kembali_info.length>1&&e.jsx("button",{type:"button",className:"text-sm text-red-600 hover:underline",onClick:()=>S(t),children:"Hapus"})]}),e.jsx("div",{children:e.jsxs("select",{value:a.kondisi,onChange:i=>_(t,"kondisi",i.target.value),className:"w-full rounded border-2 border-blue-400 bg-blue-50 p-2",children:[e.jsx("option",{value:"bagus",children:"Bagus"}),e.jsx("option",{value:"rusak",children:"Rusak"}),e.jsx("option",{value:"diperbaiki",children:"Diperbaiki"})]})})]},t)),e.jsx("datalist",{id:`serial-suggest-${o}`,children:v.filter(a=>!s.kembali_info.some(t=>t.serial_number===a)||a===s.kembali_info[0]?.serial_number).map(a=>e.jsx("option",{value:a},a))}),e.jsx("button",{type:"button",className:"mt-1 text-sm text-blue-600 hover:underline",onClick:y,disabled:!s.model,children:"+ Tambah Serial"})]})]})};function F(){const{barangKembali:s,lokasiList:o}=w().props,{data:r,setData:n,put:d,processing:p,errors:b}=C({tanggal:s.tanggal,lokasi:s.lokasi,items:s.items}),k=o.find(l=>l.nama===r.lokasi)?.id||null;c.useEffect(()=>{r.lokasi!==s.lokasi&&n("items",[{kategori:"",merek:"",model:"",kembali_info:[{serial_number:"",kondisi:"bagus"}]}])},[r.lokasi]);const x=(l,m)=>{n("items",r.items.map((h,u)=>u===l?m:h))},j=()=>{n("items",[...r.items,{kategori:"",merek:"",model:"",kembali_info:[{serial_number:"",kondisi:"bagus"}]}])},f=l=>{n("items",r.items.filter((m,h)=>h!==l))},v=l=>{l.preventDefault(),d(route("barang-kembali.update",s.id),{onSuccess:()=>N.fire({icon:"success",title:"Berhasil",text:"Data barang kembali berhasil diperbarui!",timer:2e3,showConfirmButton:!1}),onError:m=>N.fire({icon:"error",title:"Gagal",text:Object.values(m)[0]||"Periksa kembali isian form Anda."})})};return e.jsx(P,{children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Edit Transaksi Barang Kembali"}),e.jsxs("form",{onSubmit:v,className:"rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b pb-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Tanggal Pengembalian"}),e.jsx("input",{type:"date",className:"mt-1 w-full rounded border p-2",value:r.tanggal,onChange:l=>n("tanggal",l.target.value)}),b.tanggal&&e.jsx("p",{className:"text-sm text-red-500",children:b.tanggal})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Lokasi Asal Barang (Tempat Kembali)"}),e.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:r.lokasi,onChange:l=>n("lokasi",l.target.value),children:[e.jsx("option",{value:"",children:"-- Pilih Lokasi Asal --"}),o.map(l=>e.jsx("option",{value:l.nama,children:l.nama},l.id))]}),b.lokasi&&e.jsx("p",{className:"text-sm text-red-500",children:b.lokasi})]})]}),r.items.map((l,m)=>e.jsx($,{item:l,index:m,onItemChange:x,onRemove:r.items.length>1?()=>f(m):void 0,lokasiId:k},m)),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:j,className:"rounded bg-green-500 px-4 py-2 text-white hover:bg-green-600",disabled:!r.lokasi,children:"+ Tambah Item"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(K,{href:route("barang-kembali.index"),className:"rounded bg-gray-500 px-6 py-2 text-white hover:bg-gray-600",children:"Kembali"}),e.jsx("button",{type:"submit",disabled:p,className:"rounded bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:"Perbarui Transaksi"})]})]})]})]})})}export{F as default};
