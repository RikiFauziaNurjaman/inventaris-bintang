import{a as y,u as C,j as a,L as S,r as u}from"./app-CNGjdSTo.js";import{A as B}from"./app-layout-Yr-265i6.js";import{S as N}from"./sweetalert2.esm.all-BrPZ0DEU.js";/* empty css            */import"./button-BxtkxcwU.js";import"./index-BPuxuOo8.js";import"./index-DMsz7JPz.js";import"./x-B8MTmYU5.js";import"./createLucideIcon-BNUT-dRz.js";const L=({item:s,index:m,onItemChange:g,onRemove:h,errors:_,lists:l})=>{const[c,x]=u.useState([]),[j,d]=u.useState([]),[v,p]=u.useState([]);u.useEffect(()=>{if(!s.kategori){x([]);return}fetch(`/ajax/jenis-barang?kategori=${encodeURIComponent(s.kategori)}`).then(e=>e.json()).then(x)},[s.kategori]),u.useEffect(()=>{if(!s.jenis_barang){d([]);return}fetch(`/ajax/model-barang?jenis_barang=${encodeURIComponent(s.jenis_barang)}`).then(e=>e.json()).then(d)},[s.jenis_barang]),u.useEffect(()=>{if(s.rak_nama){const e=l.rakList.filter(r=>r.nama_rak===s.rak_nama).map(r=>r.baris);p(e)}},[]);const k=e=>{const r=l.rakList.filter(t=>t.nama_rak===e).map(t=>t.baris);p(r),g(m,{...s,rak_nama:e,rak_baris:"",rak_id:null})},f=e=>{const r=l.rakList.find(t=>t.nama_rak===s.rak_nama&&t.baris===e);g(m,{...s,rak_baris:e,rak_id:r?r.id:null})},i=(e,r)=>{const t={...s,[e]:r};e==="kategori"?(t.jenis_barang="",t.model=""):e==="jenis_barang"&&(t.model=""),g(m,t)},n=(e,r)=>{const t=[...s.serial_numbers];t[e]=r,i("serial_numbers",t)},o=()=>i("serial_numbers",[...s.serial_numbers,""]),b=e=>{const r=s.serial_numbers.filter((t,w)=>w!==e);i("serial_numbers",r)};return a.jsxs("div",{className:"relative mb-6 rounded-lg border-2 border-gray-200 p-4",children:[a.jsxs("h3",{className:"mb-3 text-lg font-semibold text-gray-700",children:["Barang #",m+1]}),h&&a.jsx("button",{type:"button",onClick:h,className:"absolute top-2 right-2 font-bold text-red-500 hover:text-red-700",children:"Ã— Hapus Barang"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[a.jsxs("div",{children:[a.jsx("label",{children:"Kategori"}),a.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.kategori,onChange:e=>i("kategori",e.target.value),children:[a.jsx("option",{value:"",children:"-- Pilih Kategori --"}),l.kategoriList.map(e=>a.jsx("option",{value:e.nama,children:e.nama},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Merek"}),a.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.merek,onChange:e=>i("merek",e.target.value),children:[a.jsx("option",{value:"",children:"-- Pilih Merek --"}),l.merekList.map(e=>a.jsx("option",{value:e.nama,children:e.nama},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Jenis Barang"}),a.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.jenis_barang,onChange:e=>i("jenis_barang",e.target.value),disabled:!s.kategori,children:[a.jsx("option",{value:"",children:"-- Pilih Jenis --"}),c.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Model"}),a.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.model,onChange:e=>i("model",e.target.value),disabled:!s.jenis_barang,children:[a.jsx("option",{value:"",children:"-- Pilih Model --"}),j.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{children:"Nama Rak"}),a.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.rak_nama,onChange:e=>k(e.target.value),children:[a.jsx("option",{value:"",children:"-- Pilih Rak --"}),[...new Set(l.rakList.map(e=>e.nama_rak))].map(e=>a.jsx("option",{value:e,children:e},e))]})]}),v.length>0&&a.jsxs("div",{children:[a.jsx("label",{children:"Baris"}),a.jsxs("select",{className:"mt-1 w-full rounded border p-2",value:s.rak_baris,onChange:e=>f(e.target.value),children:[a.jsx("option",{value:"",children:"-- Pilih Baris --"}),v.map(e=>a.jsx("option",{value:e,children:e},e))]})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("label",{className:"mb-2 block text-sm font-semibold text-red-700",children:"Serial Number"}),s.serial_numbers.map((e,r)=>a.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[a.jsx("input",{type:"text",className:"flex-1 rounded border-2 border-red-400 bg-red-50 p-2",value:e,onChange:t=>n(r,t.target.value),placeholder:`Serial #${r+1}`}),s.serial_numbers.length>1&&a.jsx("button",{type:"button",className:"text-sm text-red-600 hover:underline",onClick:()=>b(r),children:"Hapus"})]},r)),a.jsx("button",{type:"button",className:"mt-1 text-sm text-blue-600 hover:underline",onClick:o,children:"+ Tambah Serial"})]})]})};function J(){const{barangMasuk:s,kategoriList:m,asalList:g,merekList:h,rakList:_}=y().props,{data:l,setData:c,put:x,processing:j,errors:d,reset:v}=C({tanggal:s.tanggal||"",asal_barang:s.asal_barang||"",items:s.items||[]}),p=(n,o)=>{const b=[...l.items];b[n]=o,c("items",b)},k=()=>{const n={kategori:"",merek:"",jenis_barang:"",model:"",rak_nama:"",rak_baris:"",rak_id:null,serial_numbers:[""]};c("items",[...l.items,n])},f=n=>{const o=l.items.filter((b,e)=>e!==n);c("items",o)},i=n=>{n.preventDefault(),x(route("barang-masuk.update",s.id),{onSuccess:()=>{N.fire({icon:"success",title:"Berhasil",text:"Data berhasil diperbarui!",timer:2e3,showConfirmButton:!1})},onError:()=>{N.fire({icon:"error",title:"Gagal",text:"Periksa kembali isian form Anda."})}})};return a.jsx(B,{children:a.jsxs("div",{className:"container mx-auto p-4",children:[a.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Edit Transaksi Barang Masuk"}),a.jsxs("form",{onSubmit:i,className:"rounded-lg bg-white p-6 shadow-md",children:[a.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-6 border-b pb-6 md:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tanggal"}),a.jsx("input",{type:"date",className:"mt-1 w-full rounded border p-2",value:l.tanggal,onChange:n=>c("tanggal",n.target.value)}),d.tanggal&&a.jsx("p",{className:"text-sm text-red-500",children:d.tanggal})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Asal Barang"}),a.jsx("input",{type:"text",list:"asal-suggest",className:"mt-1 w-full rounded border p-2",value:l.asal_barang||"",onChange:n=>c("asal_barang",n.target.value)}),a.jsx("datalist",{id:"asal-suggest",children:g.map(n=>a.jsx("option",{value:n.nama},n.id))}),d.asal_barang&&a.jsx("p",{className:"text-sm text-red-500",children:d.asal_barang})]})]}),l.items.map((n,o)=>a.jsx(L,{item:n,index:o,onItemChange:p,onRemove:l.items.length>1?()=>f(o):void 0,errors:d,lists:{kategoriList:m,merekList:h,rakList:_}},o)),a.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[a.jsx("button",{type:"button",onClick:k,className:"rounded bg-green-500 px-4 py-2 text-white hover:bg-green-600",children:"+ Tambah Jenis Barang"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx(S,{href:route("barang-masuk.index"),className:"rounded bg-gray-500 px-6 py-2 text-white hover:bg-gray-600",children:"Kembali"}),a.jsx("button",{type:"submit",disabled:j,className:"rounded bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:"Perbarui Transaksi"})]})]})]})]})})}export{J as default};
